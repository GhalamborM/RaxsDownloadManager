<Window x:Class="RD.Views.UpdateWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:viewmodels="clr-namespace:RD.ViewModels"
        xmlns:converters="clr-namespace:RD.Converters"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="Check for Updates" 
        Height="500" 
        Width="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="RaxsDownloadManager Update Checker" 
                       FontSize="20" 
                       FontWeight="Bold"
                       Margin="0,0,0,10"/>
            <TextBlock Text="{Binding StatusMessage}" 
                       TextWrapping="Wrap"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
        </StackPanel>

        <!-- Version Info -->
        <StackPanel Grid.Row="1" Margin="0,0,0,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Current Version" 
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                               Margin="0,0,0,5"/>
                    <TextBlock Text="{Binding CurrentVersion}" 
                               FontSize="16"
                               FontWeight="SemiBold"/>
                </StackPanel>

                <StackPanel Grid.Column="1" 
                            Visibility="{Binding IsUpdateAvailable, Converter={StaticResource BoolToVisConverter}}">
                    <TextBlock Text="Latest Version" 
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                               Margin="0,0,0,5"/>
                    <TextBlock Text="{Binding LatestVersion}" 
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="#0078D4"/>
                </StackPanel>
            </Grid>
        </StackPanel>

        <!-- Release Notes -->
        <Border Grid.Row="2" 
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="15"
                Margin="0,0,0,20"
                Visibility="{Binding IsUpdateAvailable, Converter={StaticResource BoolToVisConverter}}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <TextBlock Text="{Binding ReleaseName}" 
                               FontSize="16"
                               FontWeight="SemiBold"
                               Margin="0,0,0,10"/>
                    <TextBlock Text="{Binding PublishedAt, StringFormat='Released on: {0:MMMM dd, yyyy}'}" 
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                               Margin="0,0,0,15"
                               Visibility="{Binding PublishedAt, Converter={StaticResource BoolToVisConverter}}"/>
                    <TextBlock Text="Release Notes:" 
                               FontWeight="SemiBold"
                               Margin="0,0,0,10"/>
                    <TextBlock Text="{Binding ReleaseNotes}" 
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Check for Updates" 
                    Command="{Binding CheckForUpdatesCommand}"
                    IsEnabled="{Binding IsChecking, Converter={StaticResource InverseBoolConverter}}"
                    Margin="0,0,10,0"
                    Padding="20,10"
                    Style="{StaticResource AccentButtonStyle}"/>

            <Button Content="Download Update" 
                    Command="{Binding OpenReleasePageCommand}"
                    Visibility="{Binding IsUpdateAvailable, Converter={StaticResource BoolToVisConverter}}"
                    Margin="0,0,10,0"
                    Padding="20,10"/>

            <Button Content="View on GitHub" 
                    Command="{Binding OpenGitHubPageCommand}"
                    Padding="20,10"
                    Margin="0,0,10,0"/>

            <Button Content="Close" 
                    Click="CloseButton_Click"
                    Padding="20,10"/>
        </StackPanel>

        <!-- Loading Indicator -->
        <ui:ProgressRing Grid.Row="0" 
                        Grid.RowSpan="4"
                        IsActive="{Binding IsChecking}"
                        Width="60"
                        Height="60"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"/>
    </Grid>
</Window>
